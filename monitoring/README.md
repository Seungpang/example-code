## Loki
Loki는 분산형 로그 관리 시스템으로, 로그를 효율적으로 수집, 저장 및 쿼리하기 위해 설계되었습니다. Grafana Labs에서 개발했으며, 특히 Kubernetes 환경에서의 사용을 염두에 두고 만들어졌습니다.

+ Distributor: 로그 스트림을 수집하고, 로그 데이터를 인덱싱 없이 배포합니다. Distributor는 수신된 로그를 각각의 로그 스트림별로 분류하여 적절한 Ingester로 전달합니다.

+ Ingester: 로그 데이터를 받는 컴포넌트로, 메모리에 로그를 저장하고 일정 주기로 청크(Chunk)로 압축하여 저장소에 기록합니다. 또한, 쿼리 시에 실시간 로그 데이터를 제공하기도 합니다.

+ Querier: 사용자의 쿼리를 받아 로그 데이터를 검색하고, 결과를 반환합니다. Querier는 Index Gateway와 Ingester로부터 데이터를 받아 병합하여 결과를 도출합니다.

+ Index Gateway: 로그 스트림의 메타데이터를 인덱싱하고, 인덱스 데이터를 관리합니다. Loki의 특징 중 하나는 로그 데이터를 인덱싱하지 않고 메타데이터만 인덱싱한다는 점입니다.

+ Storage: 로그 데이터와 인덱스를 실제로 저장하는 백엔드 저장소입니다. 주로 객체 저장소(S3, GCS 등)를 사용하며, Loki는 설정에 따라 다양한 저장소를 지원합니다.


1. 수집 (Ingestion):
+ 클라이언트(예: Promtail)가 로그 데이터를 수집하여 Distributor에 전달합니다.
+ Distributor는 로그 스트림을 분석하고, 해당 데이터를 적절한 Ingester로 라우팅합니다.

2. 저장 (Storage):
+ Ingester는 수신한 로그 데이터를 메모리에 저장합니다.
+ 일정 주기마다 Ingester는 메모리에 있는 데이터를 압축하여 청크로 만들고, 이를 저장소(Storage)에 기록합니다.

3. 인덱싱 (Indexing):
+ 로그 스트림의 메타데이터는 Index Gateway를 통해 인덱싱됩니다.
+ 메타데이터 인덱스는 로그 데이터의 위치 정보를 포함하고 있어, 쿼리 시에 빠른 접근을 가능하게 합니다.

4. 쿼리 (Query):
+ 사용자가 로그 데이터를 쿼리하면, Querier가 요청을 받습니다.
+ Querier는 필요한 로그 데이터를 찾기 위해 Index Gateway를 조회하고, 해당 로그 데이터를 포함하는 청크를 찾습니다.
+ 필요 시 Ingester로부터 실시간 데이터를 추가로 받아와서 쿼리 결과를 최종적으로 병합하여 반환합니다.


+ 효율적인 저장: Loki는 로그 데이터를 직접 인덱싱하지 않기 때문에, 저장 공간과 인덱싱 오버헤드가 적습니다.
+ 확장성: 분산형 구조로, 수집 및 저장, 쿼리하는 각 컴포넌트를 독립적으로 확장할 수 있습니다.
+ 연동성: Prometheus와 유사한 라벨링 시스템을 사용하여, 기존 Prometheus 사용자들이 쉽게 사용할 수 있습니다.
+ 비용 절감: 인덱싱을 최소화함으로써 저장소 비용을 절감할 수 있습니다.
